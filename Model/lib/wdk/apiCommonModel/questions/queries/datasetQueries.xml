<wdkModel>

  <!-- notes

  -->

  <querySet name="DatasetIds" queryType="id" isCacheable="false" includeProjects="PlasmoDB,HostDB,InitDB,PiroplasmaDB,CryptoDB,MicrosporidiaDB,FungiDB,ToxoDB,GiardiaDB,AmoebaDB,TriTrypDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Source id  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="AllDatasets"
         isCacheable="false">
        <column name="dataset_id"/>
        <sql>
          <![CDATA[
                   select dataset_presenter_id as dataset_id from apidbtuning.datasetpresenter
          ]]>
       </sql>
    </sqlQuery>

    <sqlQuery name="ByReferenceName"
         isCacheable="false">
        <testParamValues>
            <paramValue name="reference_name">GeneQuestions.GenesByTaxon</paramValue>
            <paramValue name="record_class">GeneRecordClasses.GeneRecordClass</paramValue>
        </testParamValues>

        <paramRef ref="datasetParams.reference_name"/>
        <paramRef ref="datasetParams.record_class"/>        
        <column name="dataset_id"/>

        <sql>
          <![CDATA[
                   select distinct dsp.dataset_presenter_id as dataset_id 
                   from apidbtuning.datasetmodelref ref, apidbtuning.datasetpresenter dsp
                   where dsp.dataset_presenter_id = ref.dataset_presenter_id
                   and ref.target_name = $$reference_name$$
                   and ref.record_type = $$record_class$$
          ]]>
       </sql>
    </sqlQuery>

    
    <sqlQuery name="ByExternalDatabaseNames"
         isCacheable="false">
        <testParamValues>
            <paramValue name="dataset_name">taxonomy_RSRC</paramValue>
        </testParamValues>

        <paramRef ref="datasetParams.dataset_name"/>
        <column name="dataset_id"/>
        <sql>
          <![CDATA[
          select distinct dataset_presenter_id as dataset_id
          from APIDBTUNING.datasetnametaxon 
          where name IN ($$dataset_name$$)
          ]]>
       </sql>
    </sqlQuery>


    <sqlQuery name="ByQuestionName"
         isCacheable="false">
        <testParamValues>
            <paramValue name="question_name">GeneQuestions.GenesByTaxon</paramValue>
        </testParamValues>     

        <paramRef ref="datasetParams.question_name"/>
        <column name="dataset_id"/>
        <sql>
          <![CDATA[
                   select dsp.dataset_presenter_id as dataset_id 
                   from apidbtuning.datasetmodelref ref, apidbtuning.datasetpresenter dsp
                   where dsp.dataset_presenter_id = ref.dataset_presenter_id
                   and ref.target_name = $$question_name$$
                   and ref.target_type = 'question'
          ]]>
       </sql>
    </sqlQuery>


    <!-- JB:  Weird that profile_graph is included here -->
    <sqlQuery name="ByRecordClass"
         isCacheable="false">
        <testParamValues>
          <paramValue name="record_class">GeneRecordClasses.GeneRecordClass</paramValue>
        </testParamValues>

        <paramRef ref="datasetParams.record_class"/>
        <column name="dataset_id"/>

        <sql>
          <![CDATA[
                   select DISTINCT dsp.dataset_presenter_id as dataset_id 
                   from apidbtuning.datasetmodelref ref, apidbtuning.datasetpresenter dsp
                   where dsp.dataset_presenter_id = ref.dataset_presenter_id
                   and ref.record_type = $$record_class$$
                   and ref.target_type IN ('table', 'attribute','profile_graph')
          ]]>
       </sql>
    </sqlQuery>

    <sqlQuery name="ByKeyword"
         isCacheable="false">
        <testParamValues>
          <paramValue name="text_expression">GeneDB*</paramValue>
        </testParamValues>

        <paramRef ref="sharedParams.text_expression"/>
        <column name="dataset_id"/>

        <sql>
          <![CDATA[
                   select DISTINCT dataset_presenter_id as dataset_id 
                   from apidbtuning.datasetdetail
                   where contains(search_string,replace(lower($$text_expression$$),'*','%'),1)>0
          ]]>
       </sql>
    </sqlQuery>
                   

  </querySet>
</wdkModel>
