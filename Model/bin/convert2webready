#!/usr/bin/perl

# EXAMPLE USAGE:
# grep -irl apidbtuning | convert2webready ~/sourceCode/website/ApiCommonModel/Model ~/sourceCode/ApiCommonModel/Model

use strict;
my @tables = (
'CompoundAttributes',
'CompoundId',
'CompoundProperties',
'CompoundTypeAheads',
'OntologyLevels',
'PathwayAttributes',
'PathwayCompounds',
'PathwayNodes',
'PathwayReactions',
'ChIPchipTranscript',
'ChrCopyNumbers',
'CodingSequence',
'EqtlSpan',
'EstAlignmentGeneSummary',
'EstAttributes',
'EstSequence',
'GeneAttributes',
'GeneCopyNumbers',
'GeneGoTable',
'GeneGoTerms',
'GeneId',
#'GeneIntJuncStats',
#'GeneIntronJunction',
'GeneLocations',
#'GeneMaxIntronGIJ',
'GeneModelDump',
'GeneSummaryFilter',
'GenomicSeqAttributes',
'GenomicSequenceId',
'GenomicSequenceSequence',
'GoTermSummary',
#'IntronSupportLevel',
#'IntronUtrCoords',
'OrganismAbbreviation',
'OrganismSelectTaxonRank',
'PANExtDbRls',
'PANIO',
'PathwayNodeGene',
'PathwaysGeneTable',
'PdbSimilarity',
'ProteinAttributes',
'ProteinSequence',
'RnaSeqStats',
'SequencePieceClosure',
'SignalPeptideDomains',
'Taxonomy',
'TaxonSpecies',
'TFBSGene',
'TranscriptAttributes',
'TranscriptCenDistance',
'TranscriptPathway',
'TranscriptSequence',
'TransmembraneDomains'
);

my ($sourceModelDir, $targetModelDir) = @ARGV;

while(<STDIN>) {
  chomp;
  my $filenm = $_;
  print STDERR "processing $filenm\n";
  my $filetext = do {
    local $/ = undef;
    open my $fh, "<", "$sourceModelDir/$filenm"
        or die "could not open '$sourceModelDir/$filenm': $!";
    <$fh>;
  };

  foreach my $table (@tables) {
    $filetext =~ s/apidbtuning.$table/webready.$table/gi;
  }

  open(FH, '>', "$targetModelDir/$filenm") or die $!;
  print FH $filetext;
  close FH;
}
